Reproducible Research: Peer Assessment 1
Alvaro Lopez Ortega
09/14/2014

This program analyses the data generated by personal activity monitoring devices, such as a Fitbit, Nike Fuelband, or Jawbone Up.

It will analyse a dataset consists of two months of data from an anonymous individual collected during the months of October and November, 2012 and include the number of steps taken in 5-minute intervals each day.

Loading and preprocessing the data
First things first. Let's download the dataset from the Internet if it isn't present locally. It's worth noticing thatthe downloaded data file is in ZIP format and it needs to be uncompressed before it can be used.

dataFile <- "activity.csv"
if(!file.exists(dataFile)) {
        downloadFile <- "activity.zip"
        if(!file.exists(downloadFile)) {
                URL <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
                download.file(URL, downloadFile, method = "curl")
        }
        unzip(downloadFile)
}
Once we have the raw data, it's time to load it into a data frame and make sure the structure of the data is correct.

data <- read.csv(dataFile, as.is = TRUE)
str(data)
## 'data.frame':	17568 obs. of  3 variables:
##  $ steps   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ date    : chr  "2012-10-01" "2012-10-01" "2012-10-01" "2012-10-01" ...
##  $ interval: int  0 5 10 15 20 25 30 35 40 45 ...
There are a total of 17,568 observations in this dataset. Each one of then is described with the following three variables:

steps: Number of steps taking in a 5-minute interval (missing values are coded as NA). Type numeric.
date: The date on which the measurement was taken in YYYY-MM-DD format. Type character vector.
interval: Identifier for the 5-minute interval in which measurement was taken. Type numeric.
The type of the date column is a "character" vector. For the purpose of this analysis, let's make a couple of type conversions to make the upcoming data handling easier. We'll convert date to "Date" class, and interval to factor.

data$date <- as.Date(data$date, format = "%Y-%m-%d")
data$interval <- factor(data$interval)
The structure of the data is now:

str(data)
## 'data.frame':	17568 obs. of  3 variables:
##  $ steps   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ date    : Date, format: "2012-10-01" "2012-10-01" ...
##  $ interval: Factor w/ 288 levels "0","5","10","15",..: 1 2 3 4 5 6 7 8 9 10 ...
And the summary:

summary(data)
##      steps            date               interval    
##  Min.   :  0.0   Min.   :2012-10-01   0      :   61  
##  1st Qu.:  0.0   1st Qu.:2012-10-16   5      :   61  
##  Median :  0.0   Median :2012-10-31   10     :   61  
##  Mean   : 37.4   Mean   :2012-10-31   15     :   61  
##  3rd Qu.: 12.0   3rd Qu.:2012-11-15   20     :   61  
##  Max.   :806.0   Max.   :2012-11-30   25     :   61  
##  NA's   :2304                         (Other):17202
There is a fairly high number of missing values in the sample, 2304 NA's can be found in the step variable, for instance.

What is mean total number of steps taken per day?
Firsly, we'll have to ignore the missing values for the time being and take a look at the total number of steps taken per day.

The histogram below shows the total number of steps taken per day with bin interval of 2000, ignoring the missing values.

library(ggplot2)
stepsDay <- aggregate(steps ~ date, data, sum)
qplot(steps, data = stepsDay, binwidth = 2000,
      main = "Histogram of total steps taken per day",
      xlab = "Number of steps",
      ylab = "Frequency")
plot of chunk hist_total_steps_per_day

The mean and median total number of steps taken per day can be reckoned fairly easily.

meanStepsDay <- mean(stepsDay$step)
medianStepsDay <- median(stepsDay$step)
summary(stepsDay$steps, digits = 5)
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##      41    8841   10765   10766   13294   21194
Mean total number of steps taken per day is 10766.
Median total number of steps taken per day is 10765.

What is the average daily activity pattern?
In order to study the average daily activity pattern. It's defined as the average number of steps taken per 5-minute interval across all days.

pattern <- aggregate(steps ~ interval, data, mean)
The plot of the average daily activity pattern as a time series helps to help a better understanding of the pattern.

pattern$interval <- as.integer(levels(pattern$interval)[pattern$interval])
qplot(interval, steps, data = pattern, geom = "line",
      main = "Average Daily Activity Pattern",
      xlab = "Interval",
      ylab = "Average number of steps")
plot of chunk time_series_avg_activity

Interestingly, there is a peek in the average daily activity pattern. The next logical step is to figure out in which internal that is located.

maxInterval <- pattern[which.max(pattern$steps), ]$interval
Maximum average number of steps happens on interval 835.

Imputing missing values
At this stage we ought not to continue ignoring the missing values (NA's) of the original dataset. Let's take a look a those closely.

summary(data)
##      steps            date               interval    
##  Min.   :  0.0   Min.   :2012-10-01   0      :   61  
##  1st Qu.:  0.0   1st Qu.:2012-10-16   5      :   61  
##  Median :  0.0   Median :2012-10-31   10     :   61  
##  Mean   : 37.4   Mean   :2012-10-31   15     :   61  
##  3rd Qu.: 12.0   3rd Qu.:2012-11-15   20     :   61  
##  Max.   :806.0   Max.   :2012-11-30   25     :   61  
##  NA's   :2304                         (Other):17202
missingValues <- sum(is.na(data$steps))
There are 2304 missing values in the dataset.

Even though it is a very common situation, the unknown values may be introducing bias into some of te previous calculation. We're interested in analysing if this has happen. What would happen to the mean and median total number of steps taken per day if there were no missing values?

The question is how to fill those missing values. For the sake of simplicity, let's assume the individual would have followed her average daily activity pattern and fill in the missing values with the average number of steps taken per 5-minute interval across all days for the corresponding 5-minute interval.

completeData <- merge(data, pattern, by = "interval")
missing <- is.na(completeData$steps.x)
completeData$steps.x[missing] <- completeData$steps.y[missing]
completeData <- completeData[, c(2, 3, 1)]
names(completeData) <- c("steps", "date", "interval")
There are no more NA's in the dataset. All missing values are now filled in now.

summary(completeData)
##      steps            date               interval    
##  Min.   :  0.0   Min.   :2012-10-01   0      :   61  
##  1st Qu.:  0.0   1st Qu.:2012-10-16   5      :   61  
##  Median :  0.0   Median :2012-10-31   10     :   61  
##  Mean   : 37.4   Mean   :2012-10-31   15     :   61  
##  3rd Qu.: 27.0   3rd Qu.:2012-11-15   20     :   61  
##  Max.   :806.0   Max.   :2012-11-30   25     :   61  
##                                       (Other):17202
With that new data, let's rebuild the histogram of the total number of steps taken per day.

completeStepsDay <- aggregate(steps ~ date, completeData, sum)
qplot(steps, data = completeStepsDay, binwidth = 2000,
      main = "Histogram of total steps taken per day",
      xlab = "Number of steps",
      ylab = "Frequency")
plot of chunk hist_total_steps_per_day_complete_data

And recalculate the mean and median total number of steps taken per day.

completeMeanStepsDay <- mean(completeStepsDay$step)
completeMedianStepsDay <- median(completeStepsDay$step)
summary(completeStepsDay$steps, digits = 5)
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##      41    9819   10766   10766   12811   21194
Mean total number of steps taken per day is 10766.
Median total number of steps taken per day is 10766.

There is no variation observed in the mean and the median moved closer to the mean, after imputing the missing values.

Are there differences in activity patterns between weekdays and weekends?
In order to answer this question, we'll create a new factor in the dataset with levels weekday and weekend and let's classify each date accordingly.

weekendNames <- c("Saturday", "Sunday")
completeData$day <- as.factor(ifelse(weekdays(completeData$date) %in% weekendNames, "weekend", "weekday"))
The structure of the updated dataset is now:

str(completeData)
## 'data.frame':	17568 obs. of  4 variables:
##  $ steps   : num  1.72 0 0 0 0 ...
##  $ date    : Date, format: "2012-10-01" "2012-11-23" ...
##  $ interval: Factor w/ 288 levels "0","5","10","15",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ day     : Factor w/ 2 levels "weekday","weekend": 1 1 2 1 2 1 2 1 1 2 ...
To figure if there's any difference in the activity pattern between weekdays and weekends, we will plot the average activity pattern on weekdays and weekends. As before, the average activity pattern is defined as the average number of steps taken per 5-minute interval across all days.

completePattern <- aggregate(steps ~ interval + day, completeData, mean)
completePattern$interval <- as.integer(levels(completePattern$interval)[completePattern$interval])
qplot(interval, steps, data = completePattern, geom = "line",
      facets = day ~ .,
      main = "Average Daily Activity Pattern",
      xlab = "Interval",
      ylab = "Average number of steps")
plot of chunk facet_time_series_avg_activity_complete_data

Not surprisingly, the plots reveals that the activity is more spread out during weekends, while in weekdays the individual is more active during the morning.
